<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="indoc_WI.css" rel="stylesheet" type="text/css">
    <!--Generated by indoc-->
    <title>21.10. Lengthening or shortening a list</title>
    <script type="text/javascript">
            function showExtra(id, imid) {
                if (document.getElementById(id).style.display == 'block') {
                    document.getElementById(id).style.display = 'none';
                    document.getElementById(imid).src = 'inform:/doc_images/extra.png';
                } else {
                    document.getElementById(id).style.display = 'block';
                    document.getElementById(imid).src = 'inform:/doc_images/extraclose.png';
                }
            }
            function onLoaded() {
                if (window.location.hash) {
                    var hash = window.location.hash.substring(2);
                    if (hash.search("_") >= 0) {
                        var res = hash.split("_");
                        showExample("example"+res[1]);
                    } else {
                        showExample("example"+hash);
                    }
                }
            }
            window.onload=onLoaded;
            function showExample(id) {
                if (document.getElementById(id).style.display == 'block') {
                    document.getElementById(id).style.display = 'none';
                } else {
                    document.getElementById(id).style.display = 'block';
                }
            }
            function openExtra(id, imid) {
                document.getElementById(id).style.display = 'block';
                document.getElementById(imid).src = 'inform:/doc_images/extraclose.png';
            }
            function closeExtra(id, imid) {
                document.getElementById(id).style.display = 'none';
                document.getElementById(imid).src = 'inform:/doc_images/extra.png';
            }
    </script>
</head>
<body class="paper papertint">
    <script type="text/javascript">
        function pasteCode(code) {
            var myProject = window.Project;

            myProject.selectView('source');
            myProject.pasteCode(code);
        }
    </script>
    <script type="text/javascript">
        function createNewProject(code, title) {
            var myProject = window.Project;

            myProject.createNewProject(title, code);
        }
    </script>

    <!--SEARCH TITLE "Lengthening or shortening a list"-->
    <!--SEARCH SECTION "21.10"-->
    <!--SEARCH SORT "000-021-010-000"-->
    <!--START IGNORE 358-->
    <div class="bookheader">
        <table class="fullwidth midnightblack">
            <tr>
                <td class="midnightbannerleftcell">
                    <a href="doc358.html" class="standardlink"><img alt="Hookleft.png" src="inform:/doc_images/Hookleft.png" id="hookleft"></a>
                </td>
                <td class="midnightbannercentrecell">
                    <a href="index.html" class="standardlink"><span class="midnightbannertext">Chapter 21: Lists</span></a>
                </td>
                <td class="midnightbannerrightcell">
                    <a href="index.html" class="standardlink"><img alt="Hookup.png" src="inform:/doc_images/Hookup.png" id="hookup"></a><a href="doc360.html" class="standardlink"><img alt="Hookright.png" src="inform:/doc_images/Hookright.png" id="hookright"></a>
                </td>
            </tr>
        </table>
    </div>
    <!--END IGNORE-->
    <p class="sectionheading">ยง21.10. Lengthening or shortening a list</p>
    <p>We can explicitly change the length of a list like so:</p>
        <!--START PHRASE "defn348"-->
        <div class="definition">
            <a id="defn348"></a><p class='defnprototype'><b>change </b>(list of values)<b> to have </b>(number)<b> entries</b>/entry</p>

            <!--END PHRASE-->
            <!--definition of ph_changelength-->

    <p>    This phrase alters the given list so that it now has exactly the number of entries given. Example:</p>
    <!--START CODE "c8493"-->
    <blockquote class="code"><p class="quoted"><a id="c8493"></a>change L to have 21 entries;
    </p>
    </blockquote>
    <!--END CODE-->
    <p>If L previously had more than 21 entries, they are thrown away (and lost forever); if L previously had fewer, then new entries are created, using the default value for whatever kind of value L holds. So extending a list of numbers will pad it out with 0s, but extending a list of texts will pad it out with the empty text &quot;&quot;, and so on.</p>

        <!--end definition-->
    </div>

    <p>We can also write the equivalent phrases:</p>
        <!--START PHRASE "defn349"-->
        <div class="definition">
            <a id="defn349"></a><p class='defnprototype'><b>truncate </b>(list of values)<b> to </b>(number)<b> entries</b>/entry</p>

            <!--END PHRASE-->
            <!--definition of ph_truncate-->

    <p>    This phrase alters the given list so that it now has no more than the number of entries given. Example:</p>
    <!--START CODE "c8494"-->
    <blockquote class="code"><p class="quoted"><a id="c8494"></a>truncate L to 8 entries;
    </p>
    </blockquote>
    <!--END CODE-->
    <p>shortens L to length 8 if it is currently longer than that, trimming entries from the end, but would (for instance) leave a list of length 3 unchanged. Note that</p>
    <!--START CODE "c8495"-->
    <blockquote class="code"><p class="quoted"><a id="c8495"></a>truncate L to 0 entries;
    </p>
    </blockquote>
    <!--END CODE-->
    <p>empties it to { }, the list with nothing in.</p>

        <!--end definition-->
    </div>

        <!--START PHRASE "defn350"-->
        <div class="definition">
            <a id="defn350"></a><p class='defnprototype'><b>truncate </b>(list of values)<b> to the first </b>(number)<b> entries</b>/entry</p>

            <!--END PHRASE-->
            <!--definition of ph_truncatefirst-->

    <p>    This phrase alters the given list so that it now consists only of the initial part of the list with the given length. Example:</p>
    <!--START CODE "c8496"-->
    <blockquote class="code"><p class="quoted"><a id="c8496"></a>truncate L to the first 4 entries;
    </p>
    </blockquote>
    <!--END CODE-->
    <p>turns {1, 3, 5, 7, 9, 11} to {1, 3, 5, 7}.</p>

        <!--end definition-->
    </div>

        <!--START PHRASE "defn351"-->
        <div class="definition">
            <a id="defn351"></a><p class='defnprototype'><b>truncate </b>(list of values)<b> to the last </b>(number)<b> entries</b>/entry</p>

            <!--END PHRASE-->
            <!--definition of ph_truncatelast-->

    <p>    This phrase alters the given list so that it now consists only of the final part of the list with the given length. Example:</p>
    <!--START CODE "c8497"-->
    <blockquote class="code"><p class="quoted"><a id="c8497"></a>truncate L to the last 4 entries;
    </p>
    </blockquote>
    <!--END CODE-->
    <p>turns {1, 3, 5, 7, 9, 11} to {5, 7, 9, 11}.</p>

        <!--end definition-->
    </div>

    <p>But we don't have to truncate: we can also -</p>
        <!--START PHRASE "defn352"-->
        <div class="definition">
            <a id="defn352"></a><p class='defnprototype'><b>extend </b>(list of values)<b> to </b>(number)<b> entries</b>/entry</p>

            <!--END PHRASE-->
            <!--definition of ph_extend-->

    <p>    This phrase pads out the list with default values as needed so that it now has at least the given length. (If the list is already at least that length, nothing is done.) Example:</p>
    <!--START CODE "c8498"-->
    <blockquote class="code"><p class="quoted"><a id="c8498"></a>extend L to 80 entries;
    </p>
    </blockquote>
    <!--END CODE-->
    <p>lengthens L to length 80 if it is currently shorter than that.</p>

        <!--end definition-->
    </div>

    <p>For example,</p>
    <!--START CODE "c8499"-->
    <blockquote class="code"><p class="quoted"><a id="c8499"></a>To check sorting (N - a number):
    <br>
    &#160;&#160;&#160;&#160;let L be a list of numbers;
    <br>
    &#160;&#160;&#160;&#160;extend L to N entries;
    <br>
    &#160;&#160;&#160;&#160;repeat with X running from 1 to N:
    <br>
    &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now entry X of L is X;
    <br>
    &#160;&#160;&#160;&#160;say &quot;L unrandomised is [L].&quot;;
    <br>
    &#160;&#160;&#160;&#160;sort L in random order;
    <br>
    &#160;&#160;&#160;&#160;say &quot;L randomised is [L].&quot;;
    <br>
    &#160;&#160;&#160;&#160;sort L;
    <br>
    &#160;&#160;&#160;&#160;say &quot;L in ascending order is [L].&quot;
    </p>
    </blockquote>
    <!--END CODE-->
    <p>builds a list of N numbers (initially all 0), fills it with the numbers 1, 2, 3, ..., N, then randomly reorders them, then sorts them back again, recovering the original order. The text produced by &quot;check sorting 10&quot; depends partly on chance but might for instance be:</p>
    <!--START CODE "c8500"-->
    <blockquote class="code"><p class="quoted"><a id="c8500"></a>L unrandomised is 1, 2, 3, 4, 5, 6, 7, 8, 9 and 10.
    <br>
    L randomised is 6, 2, 9, 3, 10, 1, 7, 4, 8 and 5.
    <br>
    L in ascending order is 1, 2, 3, 4, 5, 6, 7, 8, 9 and 10.
    </p>
    </blockquote>
    <!--END CODE-->
    <p>As with text in the previous chapter, a project which needs really long lists should use the Glulx virtual machine - &quot;check sorting 10000&quot;, for instance, would break the default memory environment on the Z-machine, which is very tight, but works fine (if not very rapidly) on Glulx.</p>
    <hr>
    <div class="bookexamples">
        <p class="chapterheading"></p>
        <!--START EXAMPLE "429: Leopard-skin" "e223"-->
        <a id="e223"></a><table class="egcue">
            <tr>
                <td class="egcellforoval">
                    <div class="egovalfornumber overstruckimage">
                        <a href="#" class="eglink" onclick="showExample('example223'); return false;"><b>429</b></a></div>

                </td>
                <td class="egnamecell">
                    <p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example223'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Leopard-skin</span></b></a><br>
                    A maze that the player can escape if he performs an exact sequence of actions.</p>

                </td>
                <td class="egcrossref">
                    <!--START IGNORE-->
                    <div class="egovalforxref overstruckimage">
                        <a href="Rdoc42.html#e223"><i>RB</i></a></div>
                    <!--END IGNORE-->

                </td>
            </tr>
        </table>

        <div class="egpanel" id="example223" style="display: none;">
            <p>Suppose (as in Infocom's Leather Goddesses of Phobos) that we have a maze that the player can escape only by performing the correct sequence of actions in the correct order. One way to do this would be to keep a list of the player's most recent actions, and see whether these match up with the combination we have established as the maze's solution.</p>
            <p>For instance:</p>
            <!--START CODE "c8501_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8501_223"></a><a href="javascript:pasteCode(' [=0x0022=]Leopard-skin[=0x0022=][=0x000A=][=0x000A=]The Fur-Lined Maze is a room. [=0x0022=]This seemingly endless sequence of rooms is decorated in a tasteful selection of exotic furs and gilded fixtures.[=0x0022=][=0x000A=][=0x000A=]Clapping is an action applying to nothing. Understand [=0x0022=]clap[=0x0022=] as clapping.[=0x000A=]Kweepaing is an action applying to nothing. Understand [=0x0022=]kweepa[=0x0022=] as kweepaing.[=0x000A=][=0x000A=]Carry out clapping:[=0x000A=][=0x0009=]say [=0x0022=]You clap.[=0x0022=][=0x000A=][=0x000A=]Carry out kweepaing:[=0x000A=][=0x0009=]say [=0x0022=]You holler [=0x0027=]KWEEPA![=0x0027=] triumphantly.[=0x0022=][=0x000A=][=0x000A=]The maze-sequence is a list of stored actions that varies.[=0x000A=][=0x000A=]When play begins:[=0x000A=][=0x0009=]add jumping to the maze-sequence;[=0x000A=][=0x0009=]add clapping to the maze-sequence;[=0x000A=][=0x0009=]add kweepaing to the maze-sequence.[=0x000A=][=0x000A=]The attempted-sequence is a list of stored actions that varies.[=0x000A=][=0x000A=]Every turn when the player is in the Fur-Lined Maze:[=0x000A=][=0x0009=]truncate the attempted-sequence to the last two entries;[=0x000A=][=0x0009=]add the current action to the attempted-sequence;[=0x000A=][=0x0009=]if the attempted-sequence is the maze-sequence:[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=]That does it! You are instantly transported from the maze![=0x0022=];[=0x000A=][=0x0009=][=0x0009=]end the story finally.[=0x000A=][=0x000A=]Test me with [=0x0022=]hop / clap / clap / hop / kweepa / hop / clap / kweepa[=0x0022=].[=0x000A=]\n')"><img alt="paste@2x.png" src="inform:/doc_images/paste@2x.png" width="13" height="13"></a> <a href="javascript:createNewProject(' [=0x0022=]Leopard-skin[=0x0022=][=0x000A=][=0x000A=]The Fur-Lined Maze is a room. [=0x0022=]This seemingly endless sequence of rooms is decorated in a tasteful selection of exotic furs and gilded fixtures.[=0x0022=][=0x000A=][=0x000A=]Clapping is an action applying to nothing. Understand [=0x0022=]clap[=0x0022=] as clapping.[=0x000A=]Kweepaing is an action applying to nothing. Understand [=0x0022=]kweepa[=0x0022=] as kweepaing.[=0x000A=][=0x000A=]Carry out clapping:[=0x000A=][=0x0009=]say [=0x0022=]You clap.[=0x0022=][=0x000A=][=0x000A=]Carry out kweepaing:[=0x000A=][=0x0009=]say [=0x0022=]You holler [=0x0027=]KWEEPA![=0x0027=] triumphantly.[=0x0022=][=0x000A=][=0x000A=]The maze-sequence is a list of stored actions that varies.[=0x000A=][=0x000A=]When play begins:[=0x000A=][=0x0009=]add jumping to the maze-sequence;[=0x000A=][=0x0009=]add clapping to the maze-sequence;[=0x000A=][=0x0009=]add kweepaing to the maze-sequence.[=0x000A=][=0x000A=]The attempted-sequence is a list of stored actions that varies.[=0x000A=][=0x000A=]Every turn when the player is in the Fur-Lined Maze:[=0x000A=][=0x0009=]truncate the attempted-sequence to the last two entries;[=0x000A=][=0x0009=]add the current action to the attempted-sequence;[=0x000A=][=0x0009=]if the attempted-sequence is the maze-sequence:[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=]That does it! You are instantly transported from the maze![=0x0022=];[=0x000A=][=0x0009=][=0x0009=]end the story finally.[=0x000A=][=0x000A=]Test me with [=0x0022=]hop / clap / clap / hop / kweepa / hop / clap / kweepa[=0x0022=].[=0x000A=]\n', 'Example - Leopard-skin')"><img alt="create@2x.png" src="inform:/doc_images/create@2x.png" width="26" height="13"></a>&nbsp;&nbsp;  &quot;Leopard-skin&quot;
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8502_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8502_223"></a>The Fur-Lined Maze is a room. &quot;This seemingly endless sequence of rooms is decorated in a tasteful selection of exotic furs and gilded fixtures.&quot;
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8503_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8503_223"></a>Clapping is an action applying to nothing. Understand &quot;clap&quot; as clapping.
            <br>
            Kweepaing is an action applying to nothing. Understand &quot;kweepa&quot; as kweepaing.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8504_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8504_223"></a>Carry out clapping:
            <br>
            &#160;&#160;&#160;&#160;say &quot;You clap.&quot;
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8505_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8505_223"></a>Carry out kweepaing:
            <br>
            &#160;&#160;&#160;&#160;say &quot;You holler 'KWEEPA!' triumphantly.&quot;
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8506_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8506_223"></a>The maze-sequence is a list of stored actions that varies.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8507_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8507_223"></a>When play begins:
            <br>
            &#160;&#160;&#160;&#160;add jumping to the maze-sequence;
            <br>
            &#160;&#160;&#160;&#160;add clapping to the maze-sequence;
            <br>
            &#160;&#160;&#160;&#160;add kweepaing to the maze-sequence.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8508_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8508_223"></a>The attempted-sequence is a list of stored actions that varies.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8509_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8509_223"></a>Every turn when the player is in the Fur-Lined Maze:
            <br>
            &#160;&#160;&#160;&#160;truncate the attempted-sequence to the last two entries;
            <br>
            &#160;&#160;&#160;&#160;add the current action to the attempted-sequence;
            <br>
            &#160;&#160;&#160;&#160;if the attempted-sequence is the maze-sequence:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;That does it! You are instantly transported from the maze!&quot;;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end the story finally.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8510_223"-->
            <blockquote class="code"><p class="quoted"><a id="c8510_223"></a>Test me with &quot;hop / clap / clap / hop / kweepa / hop / clap / kweepa&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
        </div>
        <p></p>
        <!--END EXAMPLE-->
        <!--START EXAMPLE "430: The Facts Were These" "e134"-->
        <a id="e134"></a><table class="egcue">
            <tr>
                <td class="egcellforoval">
                    <div class="egovalfornumber overstruckimage">
                        <a href="#" class="eglink" onclick="showExample('example134'); return false;"><b>430</b></a></div>

                </td>
                <td class="egnamecell">
                    <p class="egcuetext"><a href="#" class="eglink" onclick="showExample('example134'); return false;"><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><img class="asterisk" alt="*" src="inform:/doc_images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">The Facts Were These</span></b></a><br>
                    Creating a variant GIVE action that lets the player give multiple objects simultaneously with commands like GIVE ALL TO ATTENDANT or GIVE THREE DOLLARS TO ATTENDANT or GIVE PIE AND HAT TO ATTENDANT. The attendant accepts the gifts only if their total combined value matches some minimum amount.</p>

                </td>
                <td class="egcrossref">
                    <!--START IGNORE-->
                    <div class="egovalforxref overstruckimage">
                        <a href="Rdoc43.html#e134"><i>RB</i></a></div>
                    <!--END IGNORE-->

                </td>
            </tr>
        </table>

        <div class="egpanel" id="example134" style="display: none;">
            <p>Occasionally it happens that we want to process an action on multiple items differently than we would if the player had just typed each of the individual actions separately. In this example, the reason is that we can only successfully GIVE items when their combined value passes a certain threshold amount; otherwise the recipient will reject them.</p>
            <p>This works as an implementation of money, if we give value only to cash objects (though several other implementations of cash are available, most of which are simpler and more efficient). We could also imagine a mechanic like this being used for a bargaining or auction game as well, given a society that deals in objects rather than credits.</p>
            <p>In order to consider all the items in the gift at once, we create an action that applies to multiple objects, but will in fact test the whole object collection during the first pass and print a definitive answer to whether the action succeeded. All subsequent times the game consults the rulebook will be stopped at the very beginning. No further processing will occur or output be printed.</p>
            <!--START CODE "c8511_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8511_134"></a><a href="javascript:pasteCode('[=0x0022=]The Facts Were These[=0x0022=][=0x000A=][=0x000A=]Section 1 - Procedure[=0x000A=][=0x000A=][We start by creating the idea that everything in the game has a monetary value:][=0x000A=][=0x000A=]A price is a kind of value. $10 specifies a price. A thing has a price.[=0x000A=][=0x000A=]Understand [=0x0022=]give [things preferably held] to [someone][=0x0022=] as multiply-giving it to. Understand [=0x0022=]give [things] to [someone][=0x0022=] as multiply-giving it to.  Multiply-giving it to is an action applying to two things.[=0x000A=][=0x000A=][A subtlety here: we say [=0x0022=]things preferably held[=0x0022=] to prefer items that the player is holding (so if the player has two dollars in hand and a third lies on the ground, he will use just the two he has).][=0x000A=][=0x000A=][The second grammar line allows Inform to match things that aren[=0x0027=]t held if it can[=0x0027=]t make up the list from things that are. If all three dollars are on the ground, the player can pick them up before spending them.][=0x000A=][=0x000A=][We do not, however, make multiply-giving apply to a [=0x0022=]carried[=0x0022=] item, because that will generate implicit takes of those items in a way that will mess up our action reporting. Instead, we[=0x0027=]re going to build the implicit takes into the system in a different way, one that permits us to collate the reports more attractively and print a short, one-sentence list of anything that the player had to pick up.][=0x000A=][=0x000A=]A thing can be given or ungiven. A thing is usually ungiven.[=0x000A=][=0x000A=][This is for record-keeping purposes so that we can print an attractive list of what was given at the end of the turn.][=0x000A=][=0x000A=]First check multiply-giving it to:[=0x000A=][=0x0009=]if already gave at the office is true:[=0x000A=][=0x0009=][=0x0009=]stop the action.[=0x000A=][=0x000A=]Already gave at the office is a truth state that varies.[=0x000A=][=0x000A=][[=0x0022=]Already gave at the office[=0x0022=] is the perhaps-excessively-named flag that keeps track of whether we[=0x0027=]ve already done this action once.][=0x000A=][=0x000A=]Check multiply-giving something to the player:[=0x000A=][=0x0009=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=]You can hardly bribe yourself.[paragraph break][=0x0022=] instead;[=0x000A=][=0x000A=][The following rule is longish because it processes the entire list at once, generating implicit takes if necessary (but processing those implicit takes silently according to its own special rule, so that the output can be managed attractively). We are also, at the same time, calculating the total value of the player[=0x0027=]s offer.][=0x000A=][=0x000A=]Check multiply-giving it to:[=0x000A=][=0x0009=]let L be the multiple object list;[=0x000A=][=0x0009=]let bribe-price be $0;[=0x000A=][=0x0009=]repeat with item running through L:[=0x000A=][=0x0009=][=0x0009=]if the player does not carry the item:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]abide by the ungivability rules for the item;[=0x000A=][=0x0009=][=0x0009=][=0x0009=]carry out the implicitly taking activity with the item;[=0x000A=][=0x0009=][=0x0009=][=0x0009=]if the player does not carry the item:[=0x000A=][=0x0009=][=0x0009=][=0x0009=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=][=0x0009=][=0x0009=][=0x0009=]say [=0x0022=]You can[=0x0027=]t include [the item] in your bribe, since you[=0x0027=]re not holding [them]![paragraph break][=0x0022=] instead;[=0x000A=][=0x0009=][=0x0009=]increase bribe-price by the price of item;[=0x000A=][=0x0009=]if the number of entries in the recently-collected list is greater than 0:[=0x000A=][=0x0009=][=0x0009=]repeat with item running through the recently-collected list:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]now item is marked for listing;[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=]You pick up [the list of marked for listing things] and make your offer. [run paragraph on][=0x0022=];[=0x000A=][=0x0009=][=0x0009=]now everything is unmarked for listing;[=0x000A=][=0x0009=]if the bribe-price is less than the price of the second noun:[=0x000A=][=0x0009=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=][The second noun] angrily rejects your piffling bribe.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=][The bit about making some items [=0x0022=]marked for listing[=0x0022=], above, rather than printing the list directly, is that using the [=0x0022=][the list of....][=0x0022=] syntax guarantees that Inform will respect grouping rules in writing its description. For instance, if the player has automatically taken all three dollars, the output will say [=0x0022=]the three dollars[=0x0022=] instead of [=0x0022=]the dollar, the dollar, and the dollar.[=0x0022=]][=0x000A=][=0x000A=]Carry out multiply-giving it to:[=0x000A=][=0x0009=]let L be the multiple object list;[=0x000A=][=0x0009=]repeat with item running through L:[=0x000A=][=0x0009=][=0x0009=]now the second noun carries the item;[=0x000A=][=0x0009=][=0x0009=]now the item is given;[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x000A=]Report multiply-giving it to:[=0x000A=][=0x0009=]say [=0x0022=][The second noun] rather shamefacedly tucks [the list of given things] away into a pocket.[paragraph break][=0x0022=].[=0x000A=][=0x000A=][Now we create our own variation of implicitly taking in order to customize the output for the multiply-giving action. The [=0x0022=]ungivability rules[=0x0022=] should disallow any object that the player absolutely cannot take, because we want [=0x0022=]carry out the implicitly taking activity[=0x0022=] to succeed every time -- and therefore not print out any less-attractive results from implicit takes that don[=0x0027=]t succeed. Otherwise, the player[=0x0027=]s GIVE TREE AND DOG TO ATTENDANT might produce the reply [=0x0022=]That[=0x0027=]s fixed in place[=0x0022=] -- without specifying which object is fixed in place.][=0x000A=][=0x000A=][Because of the way this works, we will want to be careful: if we have any [=0x0022=]instead of taking...[=0x0022=] rules for special objects in the game, we should be sure to mirror those with an ungivability rule to print something more suitable in the case that the player tries taking that object as part of the multiple giving action.][=0x000A=][=0x000A=]The ungivability rules are an object-based rulebook.[=0x000A=][=0x000A=]An ungivability rule for a person:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=]Slavery is illegal.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for something (called the item) which is enclosed by someone who is not the player:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [aren[=0x0027=]t] yours to give.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for something which encloses the player:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=]You don[=0x0027=]t want to end up as part of the gift.[paragraph break][=0x0022=] instead;[=0x000A=][=0x000A=]An ungivability rule for something (called the item) which is part of something:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [are] attached to [a random thing which incorporates the item][paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for something (called the item) which is scenery:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [are] unremovable.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for something (called the item) which is fixed in place:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [are] fixed in place.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for a direction (called the item):[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [are] not susceptible to giving.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]Rule for implicitly taking something (called target) while multiply-giving:[=0x000A=][=0x0009=]silently try taking the target;[=0x000A=][=0x0009=]if the player carries the target:[=0x000A=][=0x0009=][=0x0009=]add the target to the recently-collected list.[=0x000A=][=0x000A=]The recently-collected list is a list of objects that varies.[=0x000A=][=0x000A=][And since we don[=0x0027=]t want to list the individual objects separately:][=0x000A=][=0x000A=]The selectively announce items from multiple object lists rule is listed instead of the announce items from multiple object lists rule in the action-processing rules.[=0x000A=][=0x000A=]This is the selectively announce items from multiple object lists rule:[=0x000A=][=0x0009=]if multiply-giving:[=0x000A=][=0x0009=][=0x0009=]do nothing;[=0x000A=][=0x0009=]otherwise:[=0x000A=][=0x0009=][=0x0009=]if the current item from the multiple object list is not nothing:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]say [=0x0022=][current item from the multiple object list]: [run paragraph on][=0x0022=].[=0x000A=][=0x000A=][And now, since this ought to work symmetrically if the player provides just one high-value item:][=0x000A=][=0x000A=]Check giving something to someone:[=0x000A=][=0x0009=]if the price of the noun is less than the price of the second noun:[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=][The second noun] angrily rejects your piffling bribe.[=0x0022=] instead.[=0x000A=][=0x000A=][As we[=0x0027=]ve seen elsewhere, the giving action by default returns a refusal, but is also written to start working if we remove the blockage. So we do that here, and revise the report rule to match the report rule we have for multiple giving.][=0x000A=][=0x000A=]The block giving rule is not listed in any rulebook.[=0x000A=][=0x000A=]The new report giving rule is listed instead of the standard report giving rule in the report giving it to rules.[=0x000A=][=0x000A=]This is the new report giving rule:[=0x000A=][=0x0009=]say [=0x0022=][The second noun] rather shamefacedly tucks [the noun] away into a pocket.[=0x0022=][=0x000A=][=0x000A=][After each instance of the multiply-giving action, we need to clear the variables we used to track its state. We could do this in [=0x0022=]Before reading a command[=0x0022=], but that[=0x0027=]s unsafe because the player might type GIVE PIE AND CAP TO ATTENDANT. GIVE DOLLARS TO ATTENDANT. all on a single line, and we would like to be able to clear the variables between one action and the next. The correct place to attach this behavior is immediately before the generate action rule, thus:][=0x000A=][=0x000A=]The before-generation rule is listed before the generate action rule in the turn sequence rules.[=0x000A=][=0x000A=]This is the before-generation rule:[=0x000A=][=0x0009=]now every thing is ungiven;[=0x000A=][=0x0009=]now already gave at the office is false;[=0x000A=][=0x0009=]truncate the recently-collected list to 0 entries.[=0x000A=][=0x000A=]Section 2 - Scenario[=0x000A=][=0x000A=]The Morgue Office is a room. [=0x0022=]This is not the Morgue itself; this is only its outer office. The familiar room full of silver drawers and cold air lies beyond.[=0x0022=][=0x000A=][=0x000A=]The Morgue Attendant is a man in the Morgue Office. [=0x0022=]The Attendant has seen you come through a number of times, and is becoming suspicious of your abiding interest in dead people.[=0x0022=] The description is [=0x0022=]The Morgue Attendant is fifty-four years, six months, five days, and three minutes old.[=0x0022=] The price of the Morgue Attendant is $3.[=0x000A=][=0x000A=]A dollar is a kind of thing. The player carries three dollars.  The price of a dollar is always $1.[=0x000A=][=0x000A=]The player carries a miniature rhubarb pie. The price of the miniature rhubarb pie is $5.[=0x000A=][=0x000A=]The player carries a knitted cap. The price of the knitted cap is $2.[=0x000A=][=0x000A=]Test me with [=0x0022=]test dollars / purloin three dollars / test multi-line / purloin three dollars / purloin pie / purloin cap / test specificity / purloin three dollars / test largesse / test mixed-gift[=0x0022=].[=0x000A=][=0x000A=]Test multi-line with [=0x0022=]give dollar and pie to attendant. give dollars and cap to attendant[=0x0022=].[=0x000A=][=0x000A=]Test dollars with [=0x0022=]drop all / give dollar to Morgue Attendant / give dollars to Morgue Attendant / get dollars / give dollars to morgue attendant / purloin three dollars / drop dollars / give dollars to Morgue Attendant[=0x0022=].[=0x000A=][=0x000A=]Test specificity with [=0x0022=]give three dollars to Morgue Attendant[=0x0022=].[=0x000A=][=0x000A=]Test largesse with [=0x0022=]give pie to Morgue Attendant[=0x0022=].[=0x000A=][=0x000A=]Test mixed-gift with [=0x0022=]give dollar and cap to Morgue Attendant / get cap / give dollar and cap to morgue attendant / give me and dollar to attendant[=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste@2x.png" src="inform:/doc_images/paste@2x.png" width="13" height="13"></a> <a href="javascript:createNewProject('[=0x0022=]The Facts Were These[=0x0022=][=0x000A=][=0x000A=]Section 1 - Procedure[=0x000A=][=0x000A=][We start by creating the idea that everything in the game has a monetary value:][=0x000A=][=0x000A=]A price is a kind of value. $10 specifies a price. A thing has a price.[=0x000A=][=0x000A=]Understand [=0x0022=]give [things preferably held] to [someone][=0x0022=] as multiply-giving it to. Understand [=0x0022=]give [things] to [someone][=0x0022=] as multiply-giving it to.  Multiply-giving it to is an action applying to two things.[=0x000A=][=0x000A=][A subtlety here: we say [=0x0022=]things preferably held[=0x0022=] to prefer items that the player is holding (so if the player has two dollars in hand and a third lies on the ground, he will use just the two he has).][=0x000A=][=0x000A=][The second grammar line allows Inform to match things that aren[=0x0027=]t held if it can[=0x0027=]t make up the list from things that are. If all three dollars are on the ground, the player can pick them up before spending them.][=0x000A=][=0x000A=][We do not, however, make multiply-giving apply to a [=0x0022=]carried[=0x0022=] item, because that will generate implicit takes of those items in a way that will mess up our action reporting. Instead, we[=0x0027=]re going to build the implicit takes into the system in a different way, one that permits us to collate the reports more attractively and print a short, one-sentence list of anything that the player had to pick up.][=0x000A=][=0x000A=]A thing can be given or ungiven. A thing is usually ungiven.[=0x000A=][=0x000A=][This is for record-keeping purposes so that we can print an attractive list of what was given at the end of the turn.][=0x000A=][=0x000A=]First check multiply-giving it to:[=0x000A=][=0x0009=]if already gave at the office is true:[=0x000A=][=0x0009=][=0x0009=]stop the action.[=0x000A=][=0x000A=]Already gave at the office is a truth state that varies.[=0x000A=][=0x000A=][[=0x0022=]Already gave at the office[=0x0022=] is the perhaps-excessively-named flag that keeps track of whether we[=0x0027=]ve already done this action once.][=0x000A=][=0x000A=]Check multiply-giving something to the player:[=0x000A=][=0x0009=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=]You can hardly bribe yourself.[paragraph break][=0x0022=] instead;[=0x000A=][=0x000A=][The following rule is longish because it processes the entire list at once, generating implicit takes if necessary (but processing those implicit takes silently according to its own special rule, so that the output can be managed attractively). We are also, at the same time, calculating the total value of the player[=0x0027=]s offer.][=0x000A=][=0x000A=]Check multiply-giving it to:[=0x000A=][=0x0009=]let L be the multiple object list;[=0x000A=][=0x0009=]let bribe-price be $0;[=0x000A=][=0x0009=]repeat with item running through L:[=0x000A=][=0x0009=][=0x0009=]if the player does not carry the item:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]abide by the ungivability rules for the item;[=0x000A=][=0x0009=][=0x0009=][=0x0009=]carry out the implicitly taking activity with the item;[=0x000A=][=0x0009=][=0x0009=][=0x0009=]if the player does not carry the item:[=0x000A=][=0x0009=][=0x0009=][=0x0009=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=][=0x0009=][=0x0009=][=0x0009=]say [=0x0022=]You can[=0x0027=]t include [the item] in your bribe, since you[=0x0027=]re not holding [them]![paragraph break][=0x0022=] instead;[=0x000A=][=0x0009=][=0x0009=]increase bribe-price by the price of item;[=0x000A=][=0x0009=]if the number of entries in the recently-collected list is greater than 0:[=0x000A=][=0x0009=][=0x0009=]repeat with item running through the recently-collected list:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]now item is marked for listing;[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=]You pick up [the list of marked for listing things] and make your offer. [run paragraph on][=0x0022=];[=0x000A=][=0x0009=][=0x0009=]now everything is unmarked for listing;[=0x000A=][=0x0009=]if the bribe-price is less than the price of the second noun:[=0x000A=][=0x0009=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=][The second noun] angrily rejects your piffling bribe.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=][The bit about making some items [=0x0022=]marked for listing[=0x0022=], above, rather than printing the list directly, is that using the [=0x0022=][the list of....][=0x0022=] syntax guarantees that Inform will respect grouping rules in writing its description. For instance, if the player has automatically taken all three dollars, the output will say [=0x0022=]the three dollars[=0x0022=] instead of [=0x0022=]the dollar, the dollar, and the dollar.[=0x0022=]][=0x000A=][=0x000A=]Carry out multiply-giving it to:[=0x000A=][=0x0009=]let L be the multiple object list;[=0x000A=][=0x0009=]repeat with item running through L:[=0x000A=][=0x0009=][=0x0009=]now the second noun carries the item;[=0x000A=][=0x0009=][=0x0009=]now the item is given;[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x000A=]Report multiply-giving it to:[=0x000A=][=0x0009=]say [=0x0022=][The second noun] rather shamefacedly tucks [the list of given things] away into a pocket.[paragraph break][=0x0022=].[=0x000A=][=0x000A=][Now we create our own variation of implicitly taking in order to customize the output for the multiply-giving action. The [=0x0022=]ungivability rules[=0x0022=] should disallow any object that the player absolutely cannot take, because we want [=0x0022=]carry out the implicitly taking activity[=0x0022=] to succeed every time -- and therefore not print out any less-attractive results from implicit takes that don[=0x0027=]t succeed. Otherwise, the player[=0x0027=]s GIVE TREE AND DOG TO ATTENDANT might produce the reply [=0x0022=]That[=0x0027=]s fixed in place[=0x0022=] -- without specifying which object is fixed in place.][=0x000A=][=0x000A=][Because of the way this works, we will want to be careful: if we have any [=0x0022=]instead of taking...[=0x0022=] rules for special objects in the game, we should be sure to mirror those with an ungivability rule to print something more suitable in the case that the player tries taking that object as part of the multiple giving action.][=0x000A=][=0x000A=]The ungivability rules are an object-based rulebook.[=0x000A=][=0x000A=]An ungivability rule for a person:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=]Slavery is illegal.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for something (called the item) which is enclosed by someone who is not the player:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [aren[=0x0027=]t] yours to give.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for something which encloses the player:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=]You don[=0x0027=]t want to end up as part of the gift.[paragraph break][=0x0022=] instead;[=0x000A=][=0x000A=]An ungivability rule for something (called the item) which is part of something:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [are] attached to [a random thing which incorporates the item][paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for something (called the item) which is scenery:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [are] unremovable.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for something (called the item) which is fixed in place:[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [are] fixed in place.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]An ungivability rule for a direction (called the item):[=0x000A=][=0x0009=]now already gave at the office is true;[=0x000A=][=0x0009=]say [=0x0022=][The item] [are] not susceptible to giving.[paragraph break][=0x0022=] instead.[=0x000A=][=0x000A=]Rule for implicitly taking something (called target) while multiply-giving:[=0x000A=][=0x0009=]silently try taking the target;[=0x000A=][=0x0009=]if the player carries the target:[=0x000A=][=0x0009=][=0x0009=]add the target to the recently-collected list.[=0x000A=][=0x000A=]The recently-collected list is a list of objects that varies.[=0x000A=][=0x000A=][And since we don[=0x0027=]t want to list the individual objects separately:][=0x000A=][=0x000A=]The selectively announce items from multiple object lists rule is listed instead of the announce items from multiple object lists rule in the action-processing rules.[=0x000A=][=0x000A=]This is the selectively announce items from multiple object lists rule:[=0x000A=][=0x0009=]if multiply-giving:[=0x000A=][=0x0009=][=0x0009=]do nothing;[=0x000A=][=0x0009=]otherwise:[=0x000A=][=0x0009=][=0x0009=]if the current item from the multiple object list is not nothing:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]say [=0x0022=][current item from the multiple object list]: [run paragraph on][=0x0022=].[=0x000A=][=0x000A=][And now, since this ought to work symmetrically if the player provides just one high-value item:][=0x000A=][=0x000A=]Check giving something to someone:[=0x000A=][=0x0009=]if the price of the noun is less than the price of the second noun:[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=][The second noun] angrily rejects your piffling bribe.[=0x0022=] instead.[=0x000A=][=0x000A=][As we[=0x0027=]ve seen elsewhere, the giving action by default returns a refusal, but is also written to start working if we remove the blockage. So we do that here, and revise the report rule to match the report rule we have for multiple giving.][=0x000A=][=0x000A=]The block giving rule is not listed in any rulebook.[=0x000A=][=0x000A=]The new report giving rule is listed instead of the standard report giving rule in the report giving it to rules.[=0x000A=][=0x000A=]This is the new report giving rule:[=0x000A=][=0x0009=]say [=0x0022=][The second noun] rather shamefacedly tucks [the noun] away into a pocket.[=0x0022=][=0x000A=][=0x000A=][After each instance of the multiply-giving action, we need to clear the variables we used to track its state. We could do this in [=0x0022=]Before reading a command[=0x0022=], but that[=0x0027=]s unsafe because the player might type GIVE PIE AND CAP TO ATTENDANT. GIVE DOLLARS TO ATTENDANT. all on a single line, and we would like to be able to clear the variables between one action and the next. The correct place to attach this behavior is immediately before the generate action rule, thus:][=0x000A=][=0x000A=]The before-generation rule is listed before the generate action rule in the turn sequence rules.[=0x000A=][=0x000A=]This is the before-generation rule:[=0x000A=][=0x0009=]now every thing is ungiven;[=0x000A=][=0x0009=]now already gave at the office is false;[=0x000A=][=0x0009=]truncate the recently-collected list to 0 entries.[=0x000A=][=0x000A=]Section 2 - Scenario[=0x000A=][=0x000A=]The Morgue Office is a room. [=0x0022=]This is not the Morgue itself; this is only its outer office. The familiar room full of silver drawers and cold air lies beyond.[=0x0022=][=0x000A=][=0x000A=]The Morgue Attendant is a man in the Morgue Office. [=0x0022=]The Attendant has seen you come through a number of times, and is becoming suspicious of your abiding interest in dead people.[=0x0022=] The description is [=0x0022=]The Morgue Attendant is fifty-four years, six months, five days, and three minutes old.[=0x0022=] The price of the Morgue Attendant is $3.[=0x000A=][=0x000A=]A dollar is a kind of thing. The player carries three dollars.  The price of a dollar is always $1.[=0x000A=][=0x000A=]The player carries a miniature rhubarb pie. The price of the miniature rhubarb pie is $5.[=0x000A=][=0x000A=]The player carries a knitted cap. The price of the knitted cap is $2.[=0x000A=][=0x000A=]Test me with [=0x0022=]test dollars / purloin three dollars / test multi-line / purloin three dollars / purloin pie / purloin cap / test specificity / purloin three dollars / test largesse / test mixed-gift[=0x0022=].[=0x000A=][=0x000A=]Test multi-line with [=0x0022=]give dollar and pie to attendant. give dollars and cap to attendant[=0x0022=].[=0x000A=][=0x000A=]Test dollars with [=0x0022=]drop all / give dollar to Morgue Attendant / give dollars to Morgue Attendant / get dollars / give dollars to morgue attendant / purloin three dollars / drop dollars / give dollars to Morgue Attendant[=0x0022=].[=0x000A=][=0x000A=]Test specificity with [=0x0022=]give three dollars to Morgue Attendant[=0x0022=].[=0x000A=][=0x000A=]Test largesse with [=0x0022=]give pie to Morgue Attendant[=0x0022=].[=0x000A=][=0x000A=]Test mixed-gift with [=0x0022=]give dollar and cap to Morgue Attendant / get cap / give dollar and cap to morgue attendant / give me and dollar to attendant[=0x0022=].[=0x000A=][=0x000A=]\n', 'Example - The Facts Were These')"><img alt="create@2x.png" src="inform:/doc_images/create@2x.png" width="26" height="13"></a>&nbsp;&nbsp; &quot;The Facts Were These&quot;
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8512_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8512_134"></a>Section 1 - Procedure
            </p>
            </blockquote>
            <!--END CODE-->
            <p>We start by creating the idea that everything in the game has a monetary value:</p>
            <!--START CODE "c8513_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8513_134"></a>A price is a kind of value. $10 specifies a price. A thing has a price.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8514_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8514_134"></a>Understand &quot;give [things preferably held] to [someone]&quot; as multiply-giving it to. Understand &quot;give [things] to [someone]&quot; as multiply-giving it to.  Multiply-giving it to is an action applying to two things.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>A subtlety here: we say &quot;things preferably held&quot; to prefer items that the player is holding (so if the player has two dollars in hand and a third lies on the ground, he will use just the two he has).</p>
            <p>The second grammar line allows Inform to match things that aren't held if it can't make up the list from things that are. If all three dollars are on the ground, the player can pick them up before spending them.</p>
            <p>We do not, however, make multiply-giving apply to a &quot;carried&quot; item, because that will generate implicit takes of those items in a way that will mess up our action reporting. Instead, we're going to build the implicit takes into the system in a different way, one that permits us to collate the reports more attractively and print a short, one-sentence list of anything that the player had to pick up.</p>
            <!--START CODE "c8515_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8515_134"></a>A thing can be given or ungiven. A thing is usually ungiven.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>This is for record-keeping purposes so that we can print an attractive list of what was given at the end of the turn.</p>
            <!--START CODE "c8516_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8516_134"></a>First check multiply-giving it to:
            <br>
            &#160;&#160;&#160;&#160;if already gave at the office is true:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stop the action.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8517_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8517_134"></a>Already gave at the office is a truth state that varies.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>&quot;Already gave at the office&quot; is the perhaps-excessively-named flag that keeps track of whether we've already done this action once.</p>
            <!--START CODE "c8518_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8518_134"></a>Check multiply-giving something to the player:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;You can hardly bribe yourself.[paragraph break]&quot; instead;
            </p>
            </blockquote>
            <!--END CODE-->
            <p>The following rule is longish because it processes the entire list at once, generating implicit takes if necessary (but processing those implicit takes silently according to its own special rule, so that the output can be managed attractively). We are also, at the same time, calculating the total value of the player's offer.</p>
            <!--START CODE "c8519_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8519_134"></a>Check multiply-giving it to:
            <br>
            &#160;&#160;&#160;&#160;let L be the multiple object list;
            <br>
            &#160;&#160;&#160;&#160;let bribe-price be $0;
            <br>
            &#160;&#160;&#160;&#160;repeat with item running through L:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the player does not carry the item:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;abide by the ungivability rules for the item;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;carry out the implicitly taking activity with the item;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the player does not carry the item:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;You can't include [the item] in your bribe, since you're not holding [them]![paragraph break]&quot; instead;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;increase bribe-price by the price of item;
            <br>
            &#160;&#160;&#160;&#160;if the number of entries in the recently-collected list is greater than 0:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repeat with item running through the recently-collected list:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now item is marked for listing;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;You pick up [the list of marked for listing things] and make your offer. [run paragraph on]&quot;;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now everything is unmarked for listing;
            <br>
            &#160;&#160;&#160;&#160;if the bribe-price is less than the price of the second noun:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[The second noun] angrily rejects your piffling bribe.[paragraph break]&quot; instead.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>The bit about making some items &quot;marked for listing&quot;, above, rather than printing the list directly, is that using the &quot;[the list of....]&quot; syntax guarantees that Inform will respect grouping rules in writing its description. For instance, if the player has automatically taken all three dollars, the output will say &quot;the three dollars&quot; instead of &quot;the dollar, the dollar, and the dollar.&quot;</p>
            <!--START CODE "c8520_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8520_134"></a>Carry out multiply-giving it to:
            <br>
            &#160;&#160;&#160;&#160;let L be the multiple object list;
            <br>
            &#160;&#160;&#160;&#160;repeat with item running through L:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the second noun carries the item;
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the item is given;
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is true;
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8521_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8521_134"></a>Report multiply-giving it to:
            <br>
            &#160;&#160;&#160;&#160;say &quot;[The second noun] rather shamefacedly tucks [the list of given things] away into a pocket.[paragraph break]&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>Now we create our own variation of implicitly taking in order to customize the output for the multiply-giving action. The &quot;ungivability rules&quot; should disallow any object that the player absolutely cannot take, because we want &quot;carry out the implicitly taking activity&quot; to succeed every time -- and therefore not print out any less-attractive results from implicit takes that don't succeed. Otherwise, the player's GIVE TREE AND DOG TO ATTENDANT might produce the reply &quot;That's fixed in place&quot; -- without specifying which object is fixed in place.</p>
            <p>Because of the way this works, we will want to be careful: if we have any &quot;instead of taking...&quot; rules for special objects in the game, we should be sure to mirror those with an ungivability rule to print something more suitable in the case that the player tries taking that object as part of the multiple giving action.</p>
            <!--START CODE "c8522_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8522_134"></a>The ungivability rules are an object-based rulebook.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8523_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8523_134"></a>An ungivability rule for a person:
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;say &quot;Slavery is illegal.[paragraph break]&quot; instead.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8524_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8524_134"></a>An ungivability rule for something (called the item) which is enclosed by someone who is not the player:
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;say &quot;[The item] [aren't] yours to give.[paragraph break]&quot; instead.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8525_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8525_134"></a>An ungivability rule for something which encloses the player:
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;say &quot;You don't want to end up as part of the gift.[paragraph break]&quot; instead;
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8526_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8526_134"></a>An ungivability rule for something (called the item) which is part of something:
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;say &quot;[The item] [are] attached to [a random thing which incorporates the item][paragraph break]&quot; instead.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8527_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8527_134"></a>An ungivability rule for something (called the item) which is scenery:
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;say &quot;[The item] [are] unremovable.[paragraph break]&quot; instead.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8528_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8528_134"></a>An ungivability rule for something (called the item) which is fixed in place:
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;say &quot;[The item] [are] fixed in place.[paragraph break]&quot; instead.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8529_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8529_134"></a>An ungivability rule for a direction (called the item):
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is true;
            <br>
            &#160;&#160;&#160;&#160;say &quot;[The item] [are] not susceptible to giving.[paragraph break]&quot; instead.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8530_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8530_134"></a>Rule for implicitly taking something (called target) while multiply-giving:
            <br>
            &#160;&#160;&#160;&#160;silently try taking the target;
            <br>
            &#160;&#160;&#160;&#160;if the player carries the target:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;add the target to the recently-collected list.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8531_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8531_134"></a>The recently-collected list is a list of objects that varies.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>And since we don't want to list the individual objects separately:</p>
            <!--START CODE "c8532_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8532_134"></a>The selectively announce items from multiple object lists rule is listed instead of the announce items from multiple object lists rule in the action-processing rules.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8533_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8533_134"></a>This is the selectively announce items from multiple object lists rule:
            <br>
            &#160;&#160;&#160;&#160;if multiply-giving:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;do nothing;
            <br>
            &#160;&#160;&#160;&#160;otherwise:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the current item from the multiple object list is not nothing:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[current item from the multiple object list]: [run paragraph on]&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>And now, since this ought to work symmetrically if the player provides just one high-value item:</p>
            <!--START CODE "c8534_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8534_134"></a>Check giving something to someone:
            <br>
            &#160;&#160;&#160;&#160;if the price of the noun is less than the price of the second noun:
            <br>
            &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;[The second noun] angrily rejects your piffling bribe.&quot; instead.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>As we've seen elsewhere, the giving action by default returns a refusal, but is also written to start working if we remove the blockage. So we do that here, and revise the report rule to match the report rule we have for multiple giving.</p>
            <!--START CODE "c8535_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8535_134"></a>The block giving rule is not listed in any rulebook.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8536_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8536_134"></a>The new report giving rule is listed instead of the standard report giving rule in the report giving it to rules.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8537_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8537_134"></a>This is the new report giving rule:
            <br>
            &#160;&#160;&#160;&#160;say &quot;[The second noun] rather shamefacedly tucks [the noun] away into a pocket.&quot;
            </p>
            </blockquote>
            <!--END CODE-->
            <p>After each instance of the multiply-giving action, we need to clear the variables we used to track its state. We could do this in &quot;Before reading a command&quot;, but that's unsafe because the player might type GIVE PIE AND CAP TO ATTENDANT. GIVE DOLLARS TO ATTENDANT. all on a single line, and we would like to be able to clear the variables between one action and the next. The correct place to attach this behavior is immediately before the generate action rule, thus:</p>
            <!--START CODE "c8538_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8538_134"></a>The before-generation rule is listed before the generate action rule in the turn sequence rules.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8539_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8539_134"></a>This is the before-generation rule:
            <br>
            &#160;&#160;&#160;&#160;now every thing is ungiven;
            <br>
            &#160;&#160;&#160;&#160;now already gave at the office is false;
            <br>
            &#160;&#160;&#160;&#160;truncate the recently-collected list to 0 entries.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8540_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8540_134"></a>Section 2 - Scenario
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8541_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8541_134"></a>The Morgue Office is a room. &quot;This is not the Morgue itself; this is only its outer office. The familiar room full of silver drawers and cold air lies beyond.&quot;
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8542_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8542_134"></a>The Morgue Attendant is a man in the Morgue Office. &quot;The Attendant has seen you come through a number of times, and is becoming suspicious of your abiding interest in dead people.&quot; The description is &quot;The Morgue Attendant is fifty-four years, six months, five days, and three minutes old.&quot; The price of the Morgue Attendant is $3.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8543_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8543_134"></a>A dollar is a kind of thing. The player carries three dollars.  The price of a dollar is always $1.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8544_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8544_134"></a>The player carries a miniature rhubarb pie. The price of the miniature rhubarb pie is $5.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8545_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8545_134"></a>The player carries a knitted cap. The price of the knitted cap is $2.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8546_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8546_134"></a>Test me with &quot;test dollars / purloin three dollars / test multi-line / purloin three dollars / purloin pie / purloin cap / test specificity / purloin three dollars / test largesse / test mixed-gift&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8547_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8547_134"></a>Test multi-line with &quot;give dollar and pie to attendant. give dollars and cap to attendant&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8548_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8548_134"></a>Test dollars with &quot;drop all / give dollar to Morgue Attendant / give dollars to Morgue Attendant / get dollars / give dollars to morgue attendant / purloin three dollars / drop dollars / give dollars to Morgue Attendant&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8549_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8549_134"></a>Test specificity with &quot;give three dollars to Morgue Attendant&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8550_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8550_134"></a>Test largesse with &quot;give pie to Morgue Attendant&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
            <!--START CODE "c8551_134"-->
            <blockquote class="code"><p class="quoted"><a id="c8551_134"></a>Test mixed-gift with &quot;give dollar and cap to Morgue Attendant / get cap / give dollar and cap to morgue attendant / give me and dollar to attendant&quot;.
            </p>
            </blockquote>
            <!--END CODE-->
            <p>PURLOIN, used in the tests here, is a special debugging command that allows the player to acquire objects that wouldn't otherwise be possible to take. It is only active in non-release versions of the story. For more about debugging commands, see the chapter on Testing and Debugging.</p>
        </div>
        <p></p>
        <!--END EXAMPLE-->
        <hr>
    </div>
    <!--START IGNORE-->
    <div class="bookfooter">
        <table class="fullwidth">
            <tr>
                <td class="footerprevious">
                    <a href="doc358.html" class="footerlink">Previous</a>
                </td>
                <td class="footercontents">
                    <a href="index.html" class="footerlink">Contents</a>
                </td>
                <td class="footernext">
                    <a href="doc360.html" class="footerlink">Next</a>
                </td>
            </tr>
        </table>
    </div>
    <!--END IGNORE-->
</body>
</html>
